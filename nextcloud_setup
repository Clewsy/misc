##this guide for general setup:
https://www.osradar.com/install-nextcloud-debian-9/
##used this one the second time (after kernel panic)
https://idroot.us/install-nextcloud-debian-9/

##plus the section in this guide about setting up ssl:
https://bayton.org/docs/nextcloud/installing-nextcloud-on-ubuntu-16-04-lts-with-redis-apcu-ssl-apache/

##everything following as root


#################################
##update/upgrade
apt update
apt dist-upgrade

################################
##install apache
apt install apache2
systemctl enable apache 2

##test apache by visiting http://[HOST_IP]

################################
##install php
apt install php7.0 libapache2-mod-php7.0 php7.0-common php7.0-gd php7.0-json php7.0-mysql php7.0-curl php7.0-mbstring php7.0-intl php7.0-mcrypt php7.0-imagick php7.0-xml php7.0-zip

##test php
vim /var/www/html/test.php

##copy in the following:
<?php
phpinfo();
?>

##save then visit http://[HOST_IP]/test.php

###################################
##install MariaDB
apt install mariadb-server
stsyemctl enable mariadb

##check:
systemctl status mariadb

##secure mariadb/mysql
mysql_secure_installation
## enter new password and set other options
## [enter], y, [pwd], [pwd], y, n, y, y

##create nextcloud database
mysql -u root -p

CREATE DATABASE nextcloud;
USE nextcloud;
GRANT ALL PRIVILEGES ON nextcloud.* TO 'b4t'@'localhost' IDENTIFIED BY 'password';
FLUSH PRIVILEGES;
exit;

###################################
##install nextcloud
wget https://download.nextcloud.com/server/releases/latest.zip
unzip latest.zip -d /var/www/html/
chown -R www-data:www-data /var/www/html/nextcloud/
chmod -R 755 /var/www/html/nextcloud/

##restart apache then test by visiting http://[HOST_IP]/nextcloud

##################################
##set up ssl
##in temp directory:
wget https://dl.eff.org/certbot-auto && sudo chmod a+x certbot-auto
./certbot-auto --apache --agree-tos --rsa-key-size 4096 --email jadon@clews.pro --redirect -d clews.pro
##where:
#--apache uses the Apache plugin to fully setup and integrate with the existing Apache configuration
#--agree-tos simply pre-agrees to the TOS, preventing it popping up during installation
#--rsa-key-size defines the length (and therefore security) of the RSA key. Default is 2048.
#--email is the email address to register against the certificate (used for reminders by Letâ€™s Encrypt)
#--redirect will create both the SSL virtualhost configuration file and add a redirect for HTTP traffic to HTTPs (80 to 443)
#-d is the domain to secure
##may have to run the above a few times before it is successful.
##test by visiting https://clews.pro and https://clews.pro/nextcloud

##################################
##nextcloud first use
##enter database name, user and password as set up in mariaDB
